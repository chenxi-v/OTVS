import{j as e,k as R,d as E,m as l,E as H,F as O,t as F}from"./ui-vendor-DVB09Vfq.js";import{h as K,u as U,r as o}from"./react-vendor-CM6QddGd.js";import{u as V,a as W}from"./api.service-BgeHk434.js";import{e as Y,c as q,A as B,f as G,g as J}from"./index-B2UZSTfn.js";function se(){const{sourceCode:u,vodId:g}=K(),_=U(),{videoAPIs:P}=Y(),{playback:z}=q(),[a,A]=o.useState(null),[C,k]=o.useState(!0),[d,D]=o.useState(z.defaultEpisodeOrder==="desc"),[f,S]=o.useState(""),[p,T]=o.useState(100);o.useEffect(()=>{const s=()=>{const i=window.innerWidth;let t=2,n=8;i>=1024?(t=8,n=5):i>=768?(t=6,n=6):i>=640&&(t=3,n=8),T(t*n)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),V(a?.videoInfo?.title||"视频详情");const m=()=>a?.videoInfo?.title||"",$=()=>a?.videoInfo?.cover||"https://via.placeholder.com/300x400?text=暂无封面",y=()=>a?.videoInfo?.type||"",v=()=>a?.videoInfo?.year||"",j=()=>a?.videoInfo?.director||"",b=()=>a?.videoInfo?.actor||"",N=()=>a?.videoInfo?.area||"",w=()=>a?.videoInfo?.desc||"",I=()=>a?.videoInfo?.source_name||"",h=o.useMemo(()=>{const s=a?.videoInfo?.episodes_names?.length||0;if(s===0)return[];const i=[];if(d)for(let t=0;t<s;t+=p){const n=t,r=Math.min(t+p-1,s-1),c=s-n,x=s-r;i.push({label:`${c}-${x}`,value:`${n}-${r}`,start:n,end:r})}else for(let t=0;t<s;t+=p){const n=t,r=Math.min(t+p-1,s-1);i.push({label:`${n+1}-${r+1}`,value:`${n}-${r}`,start:n,end:r})}return i},[a?.videoInfo?.episodes_names?.length,p,d]),L=o.useMemo(()=>{if(!f||!a?.videoInfo?.episodes_names)return[];const[s,i]=f.split("-").map(Number),t=a.videoInfo.episodes_names.length,n=a.videoInfo.episodes_names;if(d){const r=[];for(let c=s;c<=i;c++){const x=t-1-c;x>=0&&x<t&&r.push({name:n[x],displayIndex:c,actualIndex:x})}return r}else return n.slice(s,i+1).map((r,c)=>({name:r,displayIndex:s+c,actualIndex:s+c}))},[f,a?.videoInfo?.episodes_names,d]);o.useEffect(()=>{(async()=>{if(!(!u||!g)){k(!0);try{const i=P.find(n=>n.id===u);if(!i)throw new Error("未找到对应的API配置");const t=await W.getVideoDetail(g,i);A(t)}catch(i){console.error("获取视频详情失败:",i)}finally{k(!1)}}})()},[u,g,P]),o.useEffect(()=>{h.length!==0&&S(h[0].value)},[h,d]);const M=s=>{const i=d?(a?.videoInfo?.episodes_names?.length||0)-1-s:s;_(`/video/${u}/${g}/${i}`)};return C?e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"正在加载视频详情..."})]})}):!a||a.code!==200?e.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:e.jsxs("div",{className:"rounded-2xl bg-white/40 p-8 text-center shadow-xl backdrop-blur-xl",children:[e.jsx("p",{className:"mb-4 text-gray-500",children:"获取视频详情失败"}),e.jsx(E,{className:"bg-gradient-to-r from-blue-500 to-purple-500 font-medium text-white",onPress:()=>_(-1),children:"返回"})]})}):e.jsxs("div",{className:"container mx-auto max-w-6xl overflow-x-hidden p-2 pb-20 sm:p-4 md:pt-8",children:[e.jsx("div",{className:"mb-4 flex items-center justify-end",children:e.jsx(l.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(E,{variant:"ghost",className:"gap-2 rounded-xl bg-white/40 shadow-lg shadow-black/5 backdrop-blur-xl transition-all duration-300 hover:bg-white/60",onPress:()=>_(-1),children:[e.jsx(B,{size:18}),e.jsx("span",{className:"font-medium",children:"返回"})]})})}),e.jsxs(l.div,{className:"flex flex-col gap-4 md:flex-row md:gap-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(l.div,{className:"hidden md:block",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1},children:e.jsx("div",{className:"overflow-hidden rounded-2xl shadow-2xl shadow-black/20",children:e.jsx("img",{src:$(),alt:m(),className:"h-[320px] w-[220px] object-cover"})})}),e.jsxs(l.div,{className:"flex-1 overflow-hidden rounded-2xl bg-white/40 shadow-xl shadow-black/5 backdrop-blur-xl",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"flex gap-4 p-4",children:[e.jsx(l.img,{src:$(),alt:m(),className:"h-[180px] w-[120px] rounded-xl object-cover shadow-lg",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.4,delay:.25}}),e.jsxs(l.div,{className:"flex flex-1 flex-col gap-2",initial:{opacity:0,x:10},animate:{opacity:1,x:0},transition:{duration:.4,delay:.3},children:[m()&&e.jsx("h1",{className:"line-clamp-2 text-lg font-bold leading-tight text-gray-900",children:m()}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[I()&&e.jsx("span",{className:"rounded-full bg-gradient-to-r from-blue-500 to-purple-500 px-2 py-0.5 text-xs font-medium text-white",children:I()}),v()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700",children:v()}),y()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700",children:y()}),N()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-xs font-medium text-gray-700",children:N()})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:[j()&&e.jsxs("p",{className:"line-clamp-1",children:[e.jsx("span",{className:"font-medium text-gray-800",children:"导演："}),j()]}),b()&&e.jsxs("p",{className:"line-clamp-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:"演员："}),b()]})]})]})]}),w()&&e.jsx("div",{className:"border-t border-gray-200/50 p-4",children:e.jsx("div",{className:"line-clamp-4 text-sm text-gray-600",dangerouslySetInnerHTML:{__html:w()}})})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[m()&&e.jsx(l.h1,{className:"mb-3 text-2xl font-bold text-gray-900",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},children:m()}),e.jsxs(l.div,{className:"flex flex-wrap gap-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.4},children:[I()&&e.jsx("span",{className:"rounded-full bg-gradient-to-r from-blue-500 to-purple-500 px-3 py-1 text-sm font-medium text-white",children:I()}),v()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700",children:v()}),y()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700",children:y()}),N()&&e.jsx("span",{className:"rounded-full bg-gray-200 px-3 py-1 text-sm font-medium text-gray-700",children:N()})]})]}),e.jsxs(l.div,{className:"space-y-3",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.5},children:[j()&&e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"导演："}),e.jsx("span",{children:j()})]}),b()&&e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"演员："}),e.jsx("span",{children:b()})]})]}),w()&&e.jsxs(l.div,{className:"mt-4 rounded-xl bg-gray-50/50 p-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},children:[e.jsx("h3",{className:"mb-2 font-semibold text-gray-900",children:"剧情简介"}),e.jsx("div",{className:"text-sm leading-relaxed text-gray-600",dangerouslySetInnerHTML:{__html:w()}})]})]})})]})]}),a?.videoInfo?.episodes_names&&a.videoInfo.episodes_names.length>0&&e.jsxs(l.div,{className:"mt-6 overflow-hidden rounded-2xl bg-white/40 shadow-xl shadow-black/5 backdrop-blur-xl",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:[e.jsx("div",{className:"border-b border-gray-200/50 p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-1 rounded-full bg-gradient-to-b from-blue-500 to-purple-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"选集"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["共 ",a.videoInfo.episodes_names.length," 集"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:"sm",variant:"flat",onPress:()=>D(!d),startContent:d?e.jsx(G,{size:16}):e.jsx(J,{size:16}),className:"bg-gray-100 font-medium text-gray-700 hover:bg-gray-200",children:d?"正序":"倒序"}),h.length>1&&e.jsx(H,{size:"sm",selectedKeys:[f],onChange:s=>S(s.target.value),className:"w-28",classNames:{trigger:"bg-gray-100 border-none font-medium",value:"text-gray-700",popoverContent:"bg-white/90 backdrop-blur-xl border border-gray-200/50"},"aria-label":"选择集数范围",children:h.map(s=>e.jsx(O,{children:s.label},s.value))})]})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 p-4 sm:grid-cols-3 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8",children:L.map(({name:s,displayIndex:i},t)=>e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,delay:t*.02,ease:"easeOut"},children:e.jsx(F,{content:s,placement:"top",delay:1e3,children:e.jsx(l.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>M(i),className:"relative w-full overflow-hidden rounded-xl bg-gray-100 px-3 py-2 text-sm font-medium text-gray-700 transition-all duration-300 hover:bg-gray-200 hover:shadow-md",children:e.jsx("span",{className:"relative z-10 block overflow-hidden text-ellipsis whitespace-nowrap",children:s})})})},`${s}-${i}`))})]})]})}export{se as default};
